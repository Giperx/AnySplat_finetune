# @package _global_

defaults:
  - /dataset@_group_.lyft: lyft
  - override /model/encoder: anysplat
  - override /model/encoder/backbone: croco
  - override /loss: [mse, lpips, depth_consis] # ablate: opacity loss

wandb:
  project: anysplat_finetune1112
  name: lyft_tmp
  tags: [lyft, 448x448]
  mode: online
  
model:
  encoder:
    gs_params_head_type: dpt_gs
    pose_free: true
    intrinsics_embed_loc: encoder
    intrinsics_embed_type: token
    pretrained_weights: ''
    voxel_size: 0.002
    pred_pose: true
    anchor_feat_dim: 128
    gs_prune: false # ablate: opacity loss
    pred_head_type: depth
    freeze_backbone: false
    useVGGT: false # use vggt pretrained weights or anysplat pretrained weights
    distill: true
    frozenAggregator: false
    frozenGaussianHead: false
    frozenCameraHead: false
    frozenDepthHead: false
    render_conf: false
    conf_threshold: 0.1
    freeze_module: patch_embed
    voxelize: true
    intermediate_layer_idx: [4, 11, 17, 23]
    
dataset:
  lyft:
    input_image_shape: [448, 448]
    view_sampler:
      num_context_views: 3
      num_target_views: 1
      # min_distance_between_context_views: 32
      # max_distance_between_context_views: 256
      max_img_per_gpu: 3
    avg_pose: false
    intr_augment: false
    normalize_by_pts3d: false
    rescale_to_1cube: true

optimizer:
  lr: 0.00000125 #1.25e-6 5e-5 #2e-4
  warm_up_steps: 1000
  backbone_lr_multiplier: 0.1 #0.1

data_loader:
  train:
    batch_size: 4 # not used here
    
trainer:
  max_steps: 30000
  val_check_interval: 300
  num_nodes: 1
  accumulate_grad_batches: 1
  precision: "32"

checkpointing:
  load: anysplat_hfog_1108
  every_n_train_steps: 2000
  save_weights_only: false
  save_top_k: 100
  
train:
  pose_loss_alpha: 1.0
  pose_loss_delta: 1.0
  cxt_depth_weight: 0.0
  weight_pose: 10.0
  weight_depth: 1.0 # 1.0
  weight_normal: 0.0

hydra:
  run:
    dir: outputs/exp_${wandb.name}/${now:%Y-%m-%d_%H-%M-%S}

loss:
  mse:
    conf: false
  lpips:
    conf: false
  depth_consis:
    weight: 0.1 # 
    loss_type: MSE


